<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
      Home - Documentation
  </title>

  <link href="https://www.braintreepayments.com/images/favicon-ccda0b14.png" rel="icon" type="image/png">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
  <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
  

  

  <!-- start Mixpanel -->
  <script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("1919205b2da72e4da3b9b6639b444d59");</script>
  <!-- end Mixpanel -->
</head>

<body>
  <svg style="display: none;">
    <defs>
      <symbol id="linkIcon" fill="#706d77" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
          <path d="M0 0h24v24H0z" fill="none"/>
          <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
      </symbol>
    </defs>
  </svg>

  <input type="checkbox" id="nav-trigger" class="nav-trigger" />
  <label for="nav-trigger" class="navicon-button x">
    <div class="navicon"></div>
  </label>

  <label for="nav-trigger" class="overlay"></label>

  <div class="top-nav-wrapper">
    <ul>
      <li  class="active" >
        <a href="index.html">
          
          
            <svg fill="#178232" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
              <path d="M0 0h24v24H0z" fill="none"/>
            </svg>
          
        </a>
      </li>

      

    </ul>
  </div>

  <nav>
    <h3 class="reference-title">
      Endpoints by Classroom Tech Tools.
    </h3>

    

    <h3>Classes</h3><ul><li id="Batch-nav"><a href="Batch.html">Batch</a><ul class='methods'><li data-type="method" id="Batch-add-nav"><a href="Batch.html#add">add</a></li><li data-type="method" id="Batch-fetchAll-nav"><a href="Batch.html#fetchAll">fetchAll</a></li></ul></li><li id="DiscoveryCache-nav"><a href="DiscoveryCache.html">DiscoveryCache</a></li><li id="Request-nav"><a href="Request.html">Request</a><ul class='methods'><li data-type="method" id="Request-addQuery-nav"><a href="Request.html#addQuery">addQuery</a></li><li data-type="method" id="Request-getUrl-nav"><a href="Request.html#getUrl">getUrl</a></li></ul></li><li id="Utils-nav"><a href="Utils.html">Utils</a><ul class='methods'><li data-type="method" id="Utils-interpolate-nav"><a href="Utils.html#interpolate">interpolate</a></li><li data-type="method" id="Utils-makeQueryString-nav"><a href="Utils.html#makeQueryString">makeQueryString</a></li><li data-type="method" id="Utils-translateToTemplate-nav"><a href="Utils.html#translateToTemplate">translateToTemplate</a></li></ul></li></ul><h3 id="global-nav">Global</h3><ul><li><a href="global.html#batch">batch</a></li><li><a href="global.html#createGoogEndpoint">createGoogEndpoint</a></li><li><a href="global.html#createGoogEndpointWithOauth">createGoogEndpointWithOauth</a></li><li><a href="global.html#createRequest">createRequest</a></li><li><a href="global.html#get">get</a></li><li><a href="global.html#interpolate">interpolate</a></li><li><a href="global.html#makeGoogOauthService">makeGoogOauthService</a></li><li><a href="global.html#module">module</a></li><li><a href="global.html#post">post</a></li><li><a href="global.html#resolveUrlInterpolation">resolveUrlInterpolation</a></li></ul>
  </nav>

  <div id="main">
    

    
      



    

      


  <section class="readme">
    <article>
      <h1>Endpoints</h1>
<p>A library SDK for Google AppsScripts that makes working with google and public APIs a cinch.</p>
<h2>Quickstart</h2>
<h3>To use as a library as an AppsScripts library</h3>
<p>Library ID: <code>1WovLPVqVjZxkxkgCNgI3S_A3eDsX3DWOAoetZgRGW1JpGQ_9TK25y7mB</code>
Project ID: <code>MOwaCM3sJzFttpUe7GAFibvD8R0iiSsw_</code></p>
<h3>To import as an npm module:</h3>
<p><code>npm install @classroomtechtools/endpoints</code></p>
<p>The above will also install the following dependencies:</p>
<ul>
<li>@classroomtechtools/unittesting</li>
<li>@classroomtechtools/enforce_arguments</li>
</ul>
<h2>Tour</h2>
<p>The library uses namespaces to organize itself:</p>
<p><img src="/assets/EndpointsNamespaces.png" alt="The Namespaces"></p>
<p>As you can see, there are many methods within the <code>$</code> namespace, and they indicate that the are starter methods; you'll need to use these somehow (depending on your use case) to get started with interacting with an API.</p>
<p>Notice that <code>$.createGetRequest</code> returns a <code>Request</code> object. So let's see what's available at the <code>Endpoint.Request</code> namespace:</p>
<p><img src="/assets/EndpointsRequestNamespace.png" alt="The Namespaces"></p>
<p>Notice that all of these methods living at this namespace require a <code>Request</code> object as the first (or only) parameter? In that way, you can use autocomplete to navigate all the various methods that are available on any object created by the <code>$</code> methods.</p>
<p>There is a method <code>Endpoints.Request.getUrl</code> method, and so there is also <code>Request#getUrl</code>, which means you can do this:</p>
<pre class="prettyprint source lang-js"><code>const request = Endpoints.$.createGetRequest(url);
const url1 = request.getUrl();
// or
const url2 = request.url;
Logger.log(url1 === url2);  // true
</code></pre>
<p>Methods that start with <code>get</code> indicate that there is a property on the object which can be immediately accessed.</p>
<p>Curious to read more about what all the various methods actually do? You can read the source code, or you can do so via the online editor with <code>Endpoints.$.jdoc</code>:</p>
<pre class="prettyprint source lang-js"><code>const doc = Endpoints.$.jdoc(request.getUrl);
Logger.log(doc);
</code></pre>
<p>outputs:</p>
<pre class="prettyprint source"><code>function request_getUrl(request) {
  /**
   * Calculates the url (including any query parameters) sent/will be sent to endpoint on fetch
   * @alias request.getUrl()
   * @alias request.url
   */
</code></pre>
<p>It explains what the function does, where we learn that it'll return the full url including any query parameters that are on the <code>Request</code> object, and also the equivalent methods that live on the object.</p>
<h2>Examples</h2>
<h3>Download from Wikipedia</h3>
<p>Wikipedia offers a great API to get us started learning how to use this library to make simple requests.</p>
<pre class="prettyprint source lang-js"><code>const wpurl = 'https://test.wikipedia.org/w/api.php';
const request = Endpoints.$.createGetRequest(wpurl);
</code></pre>
<p>The documentation for this API says we have to provide it some standard query parameters, so that there's an <code>?action=query</code> and <code>&amp;format=json</code> tacked onto the end of the URL, so let's figure out how to add them.</p>
<p>We have a request object and we explore the <code>Endpoints.Request</code> namespace which indicates there is an <code>addQuery</code> method. From the tour above, we can see that the <code>request</code> variable we created from the <code>createGetRequest</code> method has <code>addQuery</code> which will take an object:</p>
<pre class="prettyprint source lang-js"><code>const query = {action: 'query', format: 'json'};
Endpoints.Request.addQuery(request, query);
// or just
request.addQuery(query);
const url = request.url;
Logger.log(url);  // url includes the query parameters
</code></pre>
<p>The target API also requires a <code>titles</code> query parameter that indicates which article we are after:</p>
<pre class="prettyprint source lang-js"><code>request.addQuery({titles: 'Albert_Einstein'});
request.url;  // the full url including query parameters
</code></pre>
<p>Let's reach out to the internet and get the response:</p>
<pre class="prettyprint source lang-js"><code>const response = request.fetch();
if (!response.ok) throw new Error(`Status code ${response.statusCode}`);
const json = response.json;
Logger.log(json);  // the response as json
</code></pre>
<h3>Interact with Google APIs, in batch mode</h3>
<p>Let's get real. We probably don't use Google AppsScripts to download wikipedia articles. We use it to build applications that depend somehow on Google APIs, such as the Spreadsheet API.</p>
<p>Imagine your application needs to write the exact same information to two different spreadsheet documents. Let's learn how to do that with the batch operations.</p>
<p>We need to create an <code>Endpoint</code> object, instead of directly creating a <code>Request</code> object as we did before, which will then be used to build the needed <code>Request</code> object. First we need to get an endpoint object intended to be used with Google APIs, which we can do via <code>Endpoints.$.createGoogEndpoint</code>. Let's learn what it does:</p>
<pre class="prettyprint source lang-js"><code>const doc = Endpoints.$.jdoc(Endpoints.$.createGoogEndpoint);
Logger.log(doc);
</code></pre>
<p>outputs:</p>
<pre class="prettyprint source"><code>function $_createGoogEndpoint (name, version, resource, method) {
/**
 * Uses the discovery service to derive the baseUrl for this particular endpoint * Users can become more familiar with possible values by using 
 * https://developers.google.com/discovery/v1/reference/apis/getRest 
 * Note: Any Google service that has a discovery endpoint can use this method to derive endpoint 
 * Note: Oauth authentication is placed in headers via ScriptApp.getOAuthToken() upon request (not upon creation) 
 * @see EndpointsBase_.discovery 
 */
}
</code></pre>
<p>Very cool. It handles oauth for us by adding headers, and using the discovery service, we see that we can pass the following:</p>
<pre class="prettyprint source lang-js"><code>const endpoint = Endpoints.$.createGoogEndpoint('sheets', 'v4', 'spreadsheets.values', 'update');  
</code></pre>
<p>This refers to the Sheets <code>&quot;sheets&quot;</code> service, version <code>&quot;v4&quot;</code>, in the resource <code>&quot;spreadsheets.values&quot;</code> and the <code>&quot;update&quot;</code> method, which is the target endpoint that Google exposes for updating spreadsheets that we have in mind. We need to create a http <code>put</code> request with that endpoint. Now that we have an endpoint object, by looking through the <code>Endpoints.Endpoint</code> namespace, we find that <code>Endpoints.Endpoint.httpput</code> method which will allow us to prepare the request object:</p>
<pre class="prettyprint source lang-js"><code>const request = endpoint.httpput(
  {    /* path parameters */		
       spreadsheetId: '&lt;id>',
       range: 'Sheet1!A1'
  },{  /* query parameters */
       valueInputOption: 'RAW'
  },{  /* payload */
       range: 'Sheet1!A1',
       majorDimension: 'ROWS',
       values: [[1]]
  }
);
</code></pre>
<p>This is all well and good, but that's kind of a lot of work. Let's use the batch functions and see why it might be worth doing that work. Imagine you need to update two different spreadsheets with the exact same info:</p>
<pre class="prettyprint source lang-js"><code>const batch = Endpoints.$.initBatch();
const ids = ['&lt;id1>', '&lt;id2>'];
    
ids.forEach(id => {
	const request = endpoint.httpput(
          range: 'Sheet1!A1',
          spreadsheetId: id
        },{
          valueInputOption: 'RAW'
        },{
          range: 'Sheet1!A1',
          majorDimension: 'ROWS',
          values: [[1]]
        }
     );
     batch.add(request);
});
    
const responses = batch.fetchAll();
</code></pre>
<p>You don't have to use the batch functions to create requests to the same endpoint. Any request that you can create with this library can be processed in batch mode.</p>
<p>Or you can build a library that abstracts away all those things for us.</p>
    </article>
  </section>


    


  </div>

  <br class="clear">

  <footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a>
  </footer>

  <script src="scripts/linenumber.js"></script>
  <script src="scripts/pagelocation.js"></script>

  

</body>
</html>
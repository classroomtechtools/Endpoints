<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
      Home - Documentation
  </title>

  <link href="https://www.braintreepayments.com/images/favicon-ccda0b14.png" rel="icon" type="image/png">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
  <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
  

  

  <!-- start Mixpanel -->
  <script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("1919205b2da72e4da3b9b6639b444d59");</script>
  <!-- end Mixpanel -->
</head>

<body>
  <svg style="display: none;">
    <defs>
      <symbol id="linkIcon" fill="#706d77" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
          <path d="M0 0h24v24H0z" fill="none"/>
          <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
      </symbol>
    </defs>
  </svg>

  <input type="checkbox" id="nav-trigger" class="nav-trigger" />
  <label for="nav-trigger" class="navicon-button x">
    <div class="navicon"></div>
  </label>

  <label for="nav-trigger" class="overlay"></label>

  <div class="top-nav-wrapper">
    <ul>
      <li  class="active" >
        <a href="index.html">
          
          
            <svg fill="#178232" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
              <path d="M0 0h24v24H0z" fill="none"/>
            </svg>
          
        </a>
      </li>

      

    </ul>
  </div>

  <nav>
    <h3 class="reference-title">
      Endpoints by Classroom Tech Tools.
    </h3>

    

    <h3>Classes</h3><ul><li id="Batch-nav"><a href="Batch.html">Batch</a><ul class='methods'><li data-type="method" id="Batch-add-nav"><a href="Batch.html#add">add</a></li><li data-type="method" id="Batch-fetchAll-nav"><a href="Batch.html#fetchAll">fetchAll</a></li></ul></li><li id="DiscoveryCache-nav"><a href="DiscoveryCache.html">DiscoveryCache</a></li><li id="Endpoint-nav"><a href="Endpoint.html">Endpoint</a><ul class='methods'><li data-type="method" id="Endpoint-createRequest-nav"><a href="Endpoint.html#createRequest">createRequest</a></li><li data-type="method" id="Endpoint-getBaseUrl-nav"><a href="Endpoint.html#getBaseUrl">getBaseUrl</a></li><li data-type="method" id="Endpoint-httpdelete-nav"><a href="Endpoint.html#httpdelete">httpdelete</a></li><li data-type="method" id="Endpoint-httpget-nav"><a href="Endpoint.html#httpget">httpget</a></li><li data-type="method" id="Endpoint-httppatch-nav"><a href="Endpoint.html#httppatch">httppatch</a></li><li data-type="method" id="Endpoint-httppost-nav"><a href="Endpoint.html#httppost">httppost</a></li><li data-type="method" id="Endpoint-httpput-nav"><a href="Endpoint.html#httpput">httpput</a></li></ul></li><li id="Request-nav"><a href="Request.html">Request</a><ul class='methods'><li data-type="method" id="Request-addQuery-nav"><a href="Request.html#addQuery">addQuery</a></li><li data-type="method" id="Request-getUrl-nav"><a href="Request.html#getUrl">getUrl</a></li></ul></li><li id="Response-nav"><a href="Response.html">Response</a><ul class='methods'><li data-type="method" id="Response-getRequest-nav"><a href="Response.html#getRequest">getRequest</a></li><li data-type="method" id="Response-getStatusCode-nav"><a href="Response.html#getStatusCode">getStatusCode</a></li><li data-type="method" id="Response-getText-nav"><a href="Response.html#getText">getText</a></li><li data-type="method" id="Response-isOk-nav"><a href="Response.html#isOk">isOk</a></li></ul></li><li id="Utils-nav"><a href="Utils.html">Utils</a><ul class='methods'><li data-type="method" id="Utils-interpolate-nav"><a href="Utils.html#interpolate">interpolate</a></li><li data-type="method" id="Utils-makeQueryString-nav"><a href="Utils.html#makeQueryString">makeQueryString</a></li><li data-type="method" id="Utils-translateToTemplate-nav"><a href="Utils.html#translateToTemplate">translateToTemplate</a></li></ul></li></ul><h3 id="global-nav">Global</h3><ul><li><a href="global.html#batch">batch</a></li><li><a href="global.html#createGoogEndpoint">createGoogEndpoint</a></li><li><a href="global.html#createGoogEndpointWithOauth">createGoogEndpointWithOauth</a></li><li><a href="global.html#createRequest">createRequest</a></li><li><a href="global.html#get">get</a></li><li><a href="global.html#interpolate">interpolate</a></li><li><a href="global.html#makeGoogOauthService">makeGoogOauthService</a></li><li><a href="global.html#module">module</a></li><li><a href="global.html#post">post</a></li><li><a href="global.html#resolveUrlInterpolation">resolveUrlInterpolation</a></li></ul>
  </nav>

  <div id="main">
    

    
      



    

      


  <section class="readme">
    <article>
      <h1>Endpoints</h1>
<p>A library SDK for Google AppsScripts that makes working with API endpoints a cinch. You can use it as an abstraction of <code>UrlFetchApp</code>, or use it to wrap Google APIs that don't have advanced services yet.</p>
<p>See the <a href="https://classroomtechtools.github.io/Endpoints/">documentation</a>.</p>
<h2>Example Libraries that use Endpoints:</h2>
<ul>
<li><a href="https://github.com/classroomtechtools/chat-adv-service">Chat Advanced Service</a>.</li>
</ul>
<h2>Quickstart</h2>
<p>Install:</p>
<ul>
<li>Library ID: <code>1WovLPVqVjZxkxkgCNgI3S_A3eDsX3DWOAoetZgRGW1JpGQ_9TK25y7mB</code></li>
<li>Project ID: <code>MOwaCM3sJzFttpUe7GAFibvD8R0iiSsw_</code></li>
</ul>
<p>Use instead of <code>UrlFetchApp.fetch</code>:</p>
<pre class="prettyprint source lang-js"><code>function myFunction () {
  // create simple get request with query parameter
  const json = Endpoints.get('https://example.com', {
    query: {
      s: 'searchstring'
    }
  });

  // create simple post request with headers and payload
  const json = Endpoints.post('https://example.com', {
    payload: {
      key: 'value'
    },
    headers: {
      'Authorization': 'Basic ' + token;
    }
  });
}
</code></pre>
<p>Or use it to interact with Google APIs:</p>
<pre class="prettyprint source lang-js"><code>function myFunction () {
  // creates endpoint with oauth as &quot;me&quot;
  const endpoint = Endpoints.createGoogEndpoint('sheets', 'v4', 'spreadsheet.values', 'get');

  // use endpoint object to create get or post requests
  const request = endpoint.httpget({spreadsheetId: '&lt;id>'});

  // the request object has fetch method
  const response = request.fetch();

  // the response object has json property
  Logger.log(response.json);
}
</code></pre>
<p>Or use it to programmatically create differenet kinds of requests:</p>
<pre class="prettyprint source lang-js"><code>function myFunction () {
  const request = Endpoints.createRequest('get', 'https://example.com');
  if (condition)
    request.addQuery({s: 'searchstring'});
  else
    request.addQuery({p: 'something'});
}
</code></pre>
<h2>Examples</h2>
<h3>Download from Wikipedia</h3>
<p>Wikipedia offers a great API to get us started learning how to use this library to make simple requests.</p>
<pre class="prettyprint source lang-js"><code>const wpurl = 'https://test.wikipedia.org/w/api.php';
const request = Endpoints.createRequest('get', wpurl);
</code></pre>
<p>The documentation for this API says we have to provide it some standard query parameters, so that there's an <code>?action=query</code> and <code>&amp;format=json</code> tacked onto the end of the URL, so let's figure out how to add them.</p>
<p>We have a request object and we explore the <code>Request</code> class which indicates there is an <code>addQuery</code> method.</p>
<pre class="prettyprint source lang-js"><code>const query = {action: 'query', format: 'json'};
request.addQuery(query);
const url = request.url;
Logger.log(url);  // url includes the query parameters
</code></pre>
<p>The target API also requires a <code>titles</code> query parameter that indicates which article we are after:</p>
<pre class="prettyprint source lang-js"><code>request.addQuery({titles: 'Albert_Einstein'});
request.url;  // the full url including previous query parameters
</code></pre>
<p>Let's reach out to the internet and get the response:</p>
<pre class="prettyprint source lang-js"><code>const response = request.fetch();
if (!response.ok) throw new Error(`Status code ${response.statusCode}`);
const json = response.json;
Logger.log(json);  // the response as json
</code></pre>
<h3>Interact with Google APIs, in batch mode</h3>
<p>Let's get real. We probably don't use Google AppsScripts to download wikipedia articles. We use it to build applications that depend somehow on Google APIs, such as the Spreadsheet API.</p>
<p>Imagine your application needs to write the exact same information to two different spreadsheet documents. Let's learn how to do that with batch operations.</p>
<pre class="prettyprint source lang-js"><code>const endpoint = Endpoints.createGoogEndpoint('sheets', 'v4', 'spreadsheets.values', 'update');  
</code></pre>
<p>Under the hood, this <code>createGoogEndpoint</code> uses the <a href="https://developers.google.com/discovery">Discovery Services API</a> to build the endpoint object.</p>
<p>In this case, we are interacting with the <code>&quot;sheets&quot;</code> service, version <code>&quot;v4&quot;</code>, in the resource <code>&quot;spreadsheets.values&quot;</code> and the <code>&quot;update&quot;</code> method, which is the target endpoint that Google exposes for updating spreadsheets that we have in mind. We need to create a http <code>put</code> request with that endpoint. Documentation for this is <a href="https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets.values/update">here</a>.</p>
<p>Now that we have an endpoint object, by looking through the <code>Endpoints</code> namespace, we find that <code>httpput</code> method which will allow us to prepare the request object:</p>
<pre class="prettyprint source lang-js"><code>const request = endpoint.httpput(
  {    /* path parameters */		
    spreadsheetId: '&lt;id>',
    range: 'Sheet1!A1'
  },{  /* request body */
    query: {
      valueInputOption: 'RAW'
    }
    payload: {
      range: 'Sheet1!A1',
      majorDimension: 'ROWS',
      values: [[1]]
    }
  }
);

const response = request.fetch();
Logger.log(response.json);  // got data
</code></pre>
<p>So the general sequence in this library is that you make an <code>Endpoint</code> instance, then on that use a method that starts with <code>http</code> to get a  <code>Request</code> instance, call <code>.fetch</code> on that to get a <code>Response</code> object, and call <code>json</code> on that to get the raw data back.</p>
<p>That's how to do one, but how to do two programmatically? Let's use the batch functions. Imagine you need to update two different spreadsheets with the exact same info:</p>
<pre class="prettyprint source lang-js"><code>const batch = Endpoints.batch();
const ids = ['&lt;id1>', '&lt;id2>'];
    
ids.forEach(id => {
  const request = endpoint.httpput({
    range: 'Sheet1!A1',
    spreadsheetId: id
  }, {
    query: {
      valueInputOption: 'RAW'
    },
    payload: {
      range: 'Sheet1!A1',
      majorDimension: 'ROWS',
      values: [[1]]
    }
  });

  batch.add(request);

});
    
const responses = batch.fetchAll();
</code></pre>
<p>You don't have to use the batch functions to create requests to the same endpoint. Any request that you can create with this library can be processed in batch mode, as long as the parameter to <code>add</code> is a <code>Request</code> object.</p>
<h2>Notes on <code>createGoogEndpoint</code></h2>
<p>This method accepts four parameters <code>name</code>, <code>version</code>, <code>resource</code> and <code>method</code>, and these four have to match how the Discovery Service is structured and kept. The best way to get the real values that are really needed (for now?) is to go to this <a href="https://developers.google.com/discovery/v1/reference/apis/list">try API page</a> and try to work out the exact terminology for the four parameters.</p>
<h3>Reference for commonly-used discovery documents</h3>
<p>Finding these names can be tricky, which is why this table can be helpful:</p>
<table>
<thead>
<tr>
<th style="text-align:left">Common Name</th>
<th style="text-align:center">name, version</th>
<th style="text-align:right">Documentation Link</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Admin SDK</td>
<td style="text-align:center">&quot;admin&quot;, &quot;directory_v1&quot;</td>
<td style="text-align:right"><a href="https://developers.google.com/admin-sdk/directory/reference/rest">link</a></td>
</tr>
<tr>
<td style="text-align:left">Sheets</td>
<td style="text-align:center">&quot;sheets&quot;, &quot;v4&quot;</td>
<td style="text-align:right"><a href="https://developers.google.com/sheets/api/reference/rest">link</a></td>
</tr>
</tbody>
</table>
<p>If you, like me, have to spend a few minutes finding them, add a pull request and I'll add it to the table.</p>
<h2>To import as an npm module:</h2>
<p><code>npm install @classroomtechtools/endpoints</code></p>
<p>The above will also install the following dependencies:</p>
<ul>
<li>@classroomtechtools/unittesting</li>
<li>@classroomtechtools/enforce_arguments</li>
</ul>
    </article>
  </section>


    


  </div>

  <br class="clear">

  <footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a>
  </footer>

  <script src="scripts/linenumber.js"></script>
  <script src="scripts/pagelocation.js"></script>

  

</body>
</html>
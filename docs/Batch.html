<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Class: Batch</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Class: Batch</h1>

    




<section>

<header>
    
        <h2><span class="attribs"><span class="type-signature"></span></span>Batch<span class="signature">(rateLimit<span class="signature-attributes">opt</span>, lastExecutionDate<span class="signature-attributes">opt</span>, verbose<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {<a href="Batch.html">Batch</a>}</span></h2>
        
            <div class="class-description"><p>An object that represents a collection of requests that will be asynchronously retrieved. Use <code>add</code> to add request objects, and then <code>fetchAll</code> which interacts with APIs concurrently and return them all. The responses will be in the same order as the requests.</p>
<p>You can also iterate over this object with <code>for â€¦ of</code> syntax, and it does so by chunking the requests, passing back time to the caller to process.</p></div>
        
    
</header>

<article>
    <div class="container-overview">
    
        

    
    <h2>Constructor</h2>
    

    
    <h4 class="name" id="Batch"><span class="type-signature"></span>new Batch<span class="signature">(rateLimit<span class="signature-attributes">opt</span>, lastExecutionDate<span class="signature-attributes">opt</span>, verbose<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {<a href="Batch.html">Batch</a>}</span></h4>
    

    



<div class="description">
    <p>Usually created with call to <code>Endpoints.batch</code></p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>rateLimit</code></td>
            

            <td class="type">
            
                
<span class="param-type">Number</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    50
                
                </td>
            

            <td class="description last"><p>The maximum number, per second, that the endpoint can take before raising 429. error. (This often applies per IP address)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>lastExecutionDate</code></td>
            

            <td class="type">
            
                
<span class="param-type">Date</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    null
                
                </td>
            

            <td class="description last"><p>Uses this as basis for understanding how much longer it has for a second to elapse. In most cases, safest to leave as <code>null</code></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>verbose</code></td>
            

            <td class="type">
            
                
<span class="param-type">Boolean</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    false
                
                </td>
            

            <td class="description last"><p>set to true if you want to see messages indicating when it's sleeping in order to ensure the rate limit isn't exceeded</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="modules_Library.js.html">modules/Library.js</a>, <a href="modules_Library.js.html#line50">line 50</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        


<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="Batch.html">Batch</a></span>


    </dd>
</dl>

    




    <h5>Example</h5>
    
    <pre class="prettyprint"><code>// create the object
const batch = Endpoints.batch();

// add request objects
batch.add({request});  // Request

// use `fetchAll` to grab them all at once
const responses = batch.fetchAll();

// get the json
const response = responses[0];
Logger.log(response.json);

// or
// iterate over the object and get one at a time
for (const response of batch) {
  Logger.logger(response.json);
}</code></pre>



    
    </div>

    

    

    

    

    

    

    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    
    <h4 class="name" id="add"><span class="type-signature"></span>add<span class="signature">(request)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Add request to batch queue</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>request</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="Request.html">Request</a></span>


            
            </td>

            

            

            <td class="description last"><p>An Endpoints.Request object</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="modules_Library.js.html">modules/Library.js</a>, <a href="modules_Library.js.html#line85">line 85</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="fetchAll"><span class="type-signature"></span>fetchAll<span class="signature">()</span><span class="type-signature"> &rarr; {Array.&lt;<a href="Response.html">Response</a>>}</span></h4>
    

    



<div class="description">
    <p>Use UrlFetchApp to reach out to the internet. Returns Response objects in same order as requests. You need to use <code>json</code> property to get the data result. Note that Response objects also have <code>request</code> property, which can be used to debug, or rebuild the original request, if necessary. Any mixin classes that are used on request creation will be available on the response object.</p>
<p>Handles 429 errors smartly. Instead of trying again with all of the requests, its subsequent attempt will only fetch those that had 429. Note that the current algorithm assumes these batch requests are going to the same endpoint. TODO: better algorithm not assuming same endpoint</p>
</div>













<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="modules_Library.js.html">modules/Library.js</a>, <a href="modules_Library.js.html#line112">line 112</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        


<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Array.&lt;<a href="Response.html">Response</a>></span>


    </dd>
</dl>

    




    <h5>Examples</h5>
    
    <pre class="prettyprint"><code>// Make list of response jsons
batch.fetchAll().map(response => response.json);</code></pre>

    <pre class="prettyprint"><code>// Make list of original request urls
batch.fetchAll().map(response => response.request.url);</code></pre>

    <pre class="prettyprint"><code>// request with mixins
const req = Endpoints.createRequest('get', {}, {
  param: 1
});
const batch = Endpoints.batch();
batch.add({request: req});
const responses = batch.fetchAll();
const response = responses[0];
Logger.log(response.param);  // 1</code></pre>



        
    

    

    
</article>

</section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Batch.html">Batch</a></li><li><a href="DiscoveryCache.html">DiscoveryCache</a></li><li><a href="Endpoint.html">Endpoint</a></li><li><a href="Oauth.html">Oauth</a></li><li><a href="Request.html">Request</a></li><li><a href="Response.html">Response</a></li><li><a href="Utils.html">Utils</a></li></ul><h3>Global</h3><ul><li><a href="global.html#batch">batch</a></li><li><a href="global.html#createGoogEndpoint">createGoogEndpoint</a></li><li><a href="global.html#createGoogEndpointWithOauth">createGoogEndpointWithOauth</a></li><li><a href="global.html#createRequest">createRequest</a></li><li><a href="global.html#get">get</a></li><li><a href="global.html#getOauthAsMe">getOauthAsMe</a></li><li><a href="global.html#interpolate">interpolate</a></li><li><a href="global.html#iterator">iterator</a></li><li><a href="global.html#makeGoogOauthService">makeGoogOauthService</a></li><li><a href="global.html#module">module</a></li><li><a href="global.html#post">post</a></li><li><a href="global.html#resolveUrlInterpolation">resolveUrlInterpolation</a></li><li><a href="global.html#toResponse">toResponse</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Wed Jul 14 2021 17:21:09 GMT+0800 (Malaysia Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>